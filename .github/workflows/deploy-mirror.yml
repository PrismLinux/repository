# Copyright (C) 2025 CrystalNetwork Studio
#
# This file is part of the CrystalNetwork Studio, PrismLinux Repository.
#
# This program is free software: you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation, either version 3 of the License, or
# (at your option) any later version.
#
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
# GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with this program. If not, see <https://www.gnu.org/licenses/>.

name: Deploy Repository Mirror

on:
  push:
    branches:
      - master
  workflow_dispatch: # Manual trigger

env:
  REPO_NAME: prismlinux

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 1

      - name: Prepare GitHub Pages
        run: |
          echo "Creating pages directory structure..."
          rm -rf public
          mkdir -p public

          echo "Copying repository contents to public directory..."

          if [ -d "x86_64" ]; then
            echo "Copying x86_64 directory..."
            cp -r x86_64 public/
          else
            echo "Warning: x86_64 directory not found"
          fi

          if [ -d "testing" ]; then
            echo "Copying testing directory..."
            cp -r testing public/
          else
            echo "Warning: testing directory not found"
          fi

          if [ -d "api" ]; then
            echo "Copying api directory..."
            cp -r api public/
          else
            echo "Warning: api directory not found"
          fi

          echo "Mirror deployment prepared successfully!"

      - name: Upload Pages artifact
        uses: actions/upload-pages-artifact@v3
        with:
          path: public

      - name: Deploy to GitHub Pages
        uses: actions/deploy-pages@v4

# Permissions needed for GitHub Pages deployment
permissions:
  contents: read
  pages: write
  id-token: write
